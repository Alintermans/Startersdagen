<div class="box-header">Wiskunde: Gezichtsherkenningsalgoritme implementeren - 6/12</div>
<div class="columns">
  <div class="column">
    <h2>Algoritme</h2>
    <p>
      Je computer stockeert de gegevens van een afbeelding in een soort matrix waarvan elke waarde op een specifieke rij of kolom staat voor een bepaalde kleurintensiteit. Als de foto een kleurenfoto (in JPEG formaat) is worden er 3 lagen aan waardes toegekend (3 lagen voor elk van de drie kleuren: rood, groen en blauw).
    </p>
    <br>
    <p>
      Echter als er nu verder gewerkt zou worden met deze matrices zou dit tot een gigantische hoeveelheid data leiden die niet meer hanteerbaar is door de computer. Daarom wordt deze data gereduceerd tot een 2D-matrix (een matrix zoals voorgesteld in figuur 1). De foto wordt m.a.w. omgezet in een foto die enkel uit grijswaardes bestaat door een gewogen gemiddelde te maken van de waardes voor rood, groen en blauw.
    </p>
    <br>
    <p>
      
      Selecteer stukjes van de foto’s en haal er een rechthoek uit met h=80 en w=60 waarbij enkel het aangezicht van de persoon zichtbaar is. Zorg dat het centrum van de neus van de persoon op h=30 en w=30 komt te staan.
    </p>
    <br>
    <p>
      Hervorm de matrix van de grijswaardes van de foto’s naar kolommatrices. Momenteel heb je een 60x80 matrix, deze moet je omvormen naar een 4800x1 matrix/vector. 
      <br>
      Momenteel heb je dus één vector die één gezicht voorstelt. Doe hetzelfde voor alle andere afbeeldingen uit de database. 
      Zo krijg je een set van M vectoren:
      $$ {\left\{v_1, v_2, ..., v_M\right\}} $$
      <br>
      Van al deze vectoren kun je een gemiddelde vector nemen die er als volgt uit ziet:
      $$ {\psi = \frac{1}{M} \sum_{i=1}^M v_i} $$

      <br>
      Nu kun je voor elke vector het verschil berekenen met de gemiddelde vector \(\psi\).
      $${ \Phi_i = v_i - \psi }$$
      <br>
      Maak nu de covariantie matrix \(C\) die als volgt gedefinieerd is:
      $${C = \frac{1}{M} \sum_{i=0}^M \Phi_i \Phi_i^T  }$$
      <br>
      Bereken nu de eigenwaarden \( \Lambda \) en eigenvectoren \(U\) van \(C\) 
      Nu heb je een collectie van eigenfaces \(U = \left\{u_i \right\}\). Hiermee kan je aan de slag gaan om andere gezichten te herkennen. 
      <br>
      Voor elke gezicht \(v\) bepaal je een gewichtsvector \( \Omega \) als volgt: 
      $${ \Omega =  U^T (v - \psi) }$$

      Een nieuw gezicht kan op diezelfde manier geprojecteerd worden op de gezichtsruimte. Hiervoor moet je opnieuw de matrix omvormen tot een kolomvector \( v_{nieuw} \). 
      Daarna voer je volgende bewerking uit:
      $${ \Omega_{nieuw} =  U^T (v_{nieuw} - \psi) }$$
      Om nu het nieuwe gezicht te herkennen kan de norm van de euclidische afstand berekend worden tusssen de kolommen \( \Omega \) en \( \Omega_{nieuw} \).
      $${ \epsilon =  \|\Omega - \Omega_{nieuw} \|  }$$
      
      De index van \( \epsilon \) met de kleinste afstand tussen \( \Omega \) en \( \Omega_{nieuw} \) geeft aan met welk gezicht er het meest overeenkomst is. 
    </p>
    

    
    </div>
  <div class="column" style="display: flex; flex-direction: column; align-items: center; justify-content: space-around;">
    <h2 style="text-align: center; margin-bottom: 0;">Leer het algoritme visueel kennen!<button style="margin-left: 10px;" onclick="reset_alg()"><i class="fas fa-undo"></i></button></h2> 
    <!-- <h3>
      Database maken
    </h3>
    <li>Afbeelding omzetten in grijstinten</li>
    <li>Afbeelding omvormen naar 60x80 pixels</li>
    <li>Matrix van afbeelding omvormen tot een kolomvector</li>
    <li>Set van kolomvectoren maken</li>
    <li>Gemiddelde vector berekenen</li>
    <li>Voor elke vector het verschil met gemiddelde vector berekenen</li>
    <li>covariantie matrix berekenen</li>
    <li>Eigenwaarden en eigenvectoren berekenen</li>
    <li>Gewichten ten opzichte van gezichtsruimte bepalen</li>

    <h3>
      Nieuwe foto herkennen
    </h3>
    <li>Afbeelding omzetten in grijstinten</li>
    <li>Afbeelding omvormen naar 60x80 pixels</li>
    <li>Matrix omvormen tot een kolomvector</li>
    <li>Verschil met gemiddelde vector berekenen</li>
    <li>Projectie op gezichtsruimte</li>
    <li>Norm van de euclidische afstand bepalen tussen de kolommen van Omega en vector Omega_nieuw</li>
    <li>Minimum zoeken</li> -->
    <!-- <input type="file" id="fileInput" multiple>
    <div id="output"></div> -->

    <div id="alg-0" class="alg-frame" >
      <div style="text-align: center;">
        <h3>Stap 1: Knip afbeelding uit en vorm om naar juiste resolutie</h3>
        <p style="padding-left: 20px; padding-right: 20px;" > 
          Om ervoor te zorgen dat het algoritme goed werkt, moeten alle afbeeldingen in de database dezelfde resolutie hebben en enkel van het hoofd. Daarom moet je de afbeeldingen eerst bijsnijden en omvormen naar een resolutie van 115x80 pixels. 
          Achter de schermen gebeurt dit allemaal voor jou. Als je op de knop hieronder drukt zal je de bewerking zien gebeuren bij prof. Vander Sloten.
        </p>
      </div>
      
      <div style="display: flex; flex-direction: row; justify-content: center; width:100%; align-items: center;">
        <canvas id="cnv_alg_0" style="border-radius: 10px; height: 200px;"></canvas>
        <button class="button" onclick="alg_crop_and_scale()" style="margin-top: 10px; padding: 10px; height: 40px; margin-left: 20px;">Knip uit & vorm om</button>
      </div>
      
    </div>

    <div id="alg-1" class="alg-frame" style="display: none;">
      
      <div style="text-align: center;">
        <h3>Stap 2: Zet afbeelding om in grijswaarden</h3>
        <p style="padding-left: 20px; padding-right: 20px;" > 
          Het algoritme werkt enkel met grijswaarden. Daarom moet je de afbeeldingen eerst omzetten naar grijswaarden. Hieronder zie je hoe dit gebeurt bij prof. Vander Sloten.
        </p>
      </div>
      <div style="display: flex; flex-direction: row; justify-content: center; width:100%; align-items: center;">
        <canvas id="cnv_alg_1" style="border-radius: 10px; height: 200px;"></canvas>
        <button class="button" onclick="alg_to_grey()" style="margin-top: 10px; padding: 10px; height: 40px; margin-left: 20px;">Naar grijswaarden</button>
      </div>
      
    </div>

    <div id="alg-2" class="alg-frame" style="display: none;">
      <div style="text-align: center;">
        <h3>Stap 3: Gemiddeld gezicht maken</h3>
      <p style="padding-left: 20px; padding-right: 20px;" > 
        Om het algoritme te laten werken, moet je eerst een gemiddeld gezicht maken. Dit doe je door alle gezichten in de database op te tellen en te delen door het aantal gezichten. Hieronder kan je het gezicht van prof. Vander Sloten zien vergelijken met het gemiddelde gezicht.
        </p>  
      </div>
      

      <div style="display: flex; flex-direction: row; justify-content: center; width:100%; align-items: center;">
        <canvas id="cnv_alg_2" style="border-radius: 10px; height: 200px;"></canvas>
        <button class="button" onclick="alg_to_mean()" style="margin-top: 10px; padding: 10px; height: 40px; margin-left: 20px;">Naar gemiddeld gezicht</button>
      </div>
    </div>

    <div id="alg-3" class="alg-frame" style="display: none;">
      <div style="text-align: center;">
        <h3>Stap 4: Verschil met gemiddeld gezicht</h3>
      <p style="padding-left: 20px; padding-right: 20px;" > 
        Zoals ook hiernaast staat uitgelegd gaan we van elk gezicht het verschil berekenen met het gemiddelde gezicht. Dit doen we door van elk gezicht het gemiddelde gezicht af te trekken. Hieronder kan je zien hoe dit gebeurt bij prof. Vander Sloten.
      </p> 
      </div>
      <div style="display: flex; flex-direction: row; justify-content: center; width:100%; align-items: center;">
        <canvas id="cnv_alg_3" style="border-radius: 10px; height: 200px;"></canvas>
        <button class="button" onclick="alg_to_diff()" style="margin-top: 10px; padding: 10px; height: 40px; margin-left: 20px;">Verschil met gemiddeld gezicht</button>
      </div>
    </div>

    <div id="alg-4" class="alg-frame" style="display: none;">
      
      <div style="text-align: center;">
        <h3>Stap 5: Eigenfaces Berekenen</h3>
      <p style="padding-left: 20px; padding-right: 20px;" > 
        Eens de verschillen met het gemiddelde gezicht berekend zijn, kunnen we de eigenfaces berekenen. Dit doen we door de covariantie matrix te berekenen en de eigenwaarden en eigenvectoren te bepalen. Eens we de eigenvectoren en eigenwaarden hebben bepaald, houden we enkel de eigenvectoren bij die de grootste eigenwaarden hebben. Deze eigenvectoren noemen we de eigenfaces. Hieronder kan je de eigenface hoorende bij de grootste eigenwaarde vergeleken met het verschil van prof. Vander Sloten.
        Nadat alle eigenfaces zijn berekend, maken we een gewichten matrix, zoals hiernaast uitgelegd. Deze gewichten matrix kunnen we gebruiken om nieuwe gezichten te herkennen.
        </p>
      </div>
      <div style="display: flex; flex-direction: row; justify-content: center; width:100%; align-items: center;">
        <canvas id="cnv_alg_4" style="border-radius: 10px; height: 200px;"></canvas>
        <button class="button" onclick="alg_to_eigenfaces()" style="margin-top: 10px; padding: 10px; height: 40px; margin-left: 20px;">Eigenfaces berekenen</button>
      </div>
    </div>

    <div id="alg-5" class="alg-frame" style="display: none;">
      
      <div style="text-align: center;">
        <h3>Stap 6: Gezichten vergelijken</h3>
      <p style="padding-left: 20px; padding-right: 20px;" > 
        Nu alles is berekend, kunnen we het algoritme gebruiken om nieuwe gezichten te herkennen. Dit doen we door de gewichten matrix te berekenen van het nieuwe gezicht en de norm van de euclidische afstand te berekenen tussen de gewichten matrix van het nieuwe gezicht en de gewichten matrix van de gezichten in de database. Het gezicht met de kleinste afstand is het gezicht dat het meest overeenkomt met het nieuwe gezicht. We kunnen het ook gebruiken om te zien hoeveel een totaal nieuw persoon lijkt op de gezichten in de database. Welke professor lijkt het meest op Mr. Bean? Kom het te weten door op de knop te drukken!
      </p>
      </div>
      <button class="button" onclick="alg_compare()" style="margin-top: 10px; padding: 10px; height: 40px; margin-left: 20px;">Vergelijk!</button>
      <div style="display: flex; flex-direction: row; justify-content: center; width:100%; align-items: center;">
        <img src="{{ url_for('static', filename='images/mr_bean_cut.png') }}" style="border-radius: 10px; height: 200px;">
        <img src="{{ url_for('static', filename='images/closest_match.png') }}" style="display: none; border-radius: 10px; height: 200px; margin-left: 20px;" id="closest_match">
      </div>
        De top 5 van gezichten die het meest overeenkomen met Mr. Bean zijn:
        <ol id="closest_matches" style="display: none;">
          <li>Prof. Rijmen</li>
          <li>Prof. Vander Sloten</li>
          <li>Prof. Baelmans</li>
          <li>Prof. Van Hamme</li>
          <li>Prof. De Laet</li>
        </ol>

    </div>

    
    

    <button class="button" onclick="next_step_alg()" id="next_step_alg_btn"  style="margin-top: 10px; padding: 10px; align-self: center;"><i class="fas fa-arrow-right"></i> Volgende stap</button>
  </div>
</div>

